{% extends 'base.html' %}

{% block content %}
<div class="form-box">
    <form class="form" method="POST">
        <span class="title">Registro:</span>
        <div class="form-container">
            {{ form.csrf_token }}
            
            {{ form.email(class_="input", placeholder="correo electrÃ³nico") }}
            {{ form.nombre(class_="input", placeholder="nombre") }}
            {{ form.apellido(class_="input", placeholder="apellido") }}
            
            <!-- Campo de telÃ©fono con dropdown personalizado -->
            <div class="telefono-simple">
                {{ form.telefono(id="wtf_telefono", style="display: none;") }}
                <div class="country-selector">
                    <div class="selected-country" id="selected-country">
                        <span class="country-flag">ðŸ‡ºðŸ‡¸</span>
                        <span class="country-code">+1</span>
                        <span class="arrow">â–¼</span>
                    </div>
                    <div class="country-dropdown" id="country-dropdown">
                        <div class="country-option" data-value="+1" data-flag="ðŸ‡ºðŸ‡¸" data-code="+1">
                            <span class="option-flag">ðŸ‡ºðŸ‡¸</span>
                            <span class="option-text">USA +1</span>
                        </div>
                        <div class="country-option" data-value="+52" data-flag="ðŸ‡²ðŸ‡½" data-code="+52">
                            <span class="option-flag">ðŸ‡²ðŸ‡½</span>
                            <span class="option-text">MÃ©xico +52</span>
                        </div>
                        <div class="country-option" data-value="+54" data-flag="ðŸ‡¦ðŸ‡·" data-code="+54">
                            <span class="option-flag">ðŸ‡¦ðŸ‡·</span>
                            <span class="option-text">Argentina +54</span>
                        </div>
                        <div class="country-option" data-value="+55" data-flag="ðŸ‡§ðŸ‡·" data-code="+55">
                            <span class="option-flag">ðŸ‡§ðŸ‡·</span>
                            <span class="option-text">Brasil +55</span>
                        </div>
                        <div class="country-option" data-value="+57" data-flag="ðŸ‡¨ðŸ‡´" data-code="+57">
                            <span class="option-flag">ðŸ‡¨ðŸ‡´</span>
                            <span class="option-text">Colombia +57</span>
                        </div>
                    </div>
                </div>
                <input type="tel" id="fancy_telefono" placeholder="telÃ©fono" class="input-simple">
            </div>
            <div class="campo-grupo">
                {{ form.passw(class_="input", placeholder="contraseÃ±a") }}
                {% if form.passw.errors %}
                    <div class="errores">
                        {% for error in form.passw.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        
        <button type="submit">crear cuenta</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var wtf_phone_field = document.getElementById('wtf_telefono');
        var selectedCountry = document.getElementById('selected-country');
        var countryDropdown = document.getElementById('country-dropdown');
        var fancy_phone_field = document.getElementById('fancy_telefono');
        var countryOptions = document.querySelectorAll('.country-option');
        
        var currentCountry = '+1';
        var currentFlag = 'ðŸ‡ºðŸ‡¸';
        
        // Toggle dropdown
        selectedCountry.addEventListener('click', function(e) {
            e.stopPropagation();
            countryDropdown.classList.toggle('active');
        });
        
        // Seleccionar paÃ­s
        countryOptions.forEach(function(option) {
            option.addEventListener('click', function() {
                var value = this.getAttribute('data-value');
                var flag = this.getAttribute('data-flag');
                var code = this.getAttribute('data-code');
                
                currentCountry = value;
                currentFlag = flag;
                
                // Actualizar solo la bandera y cÃ³digo (texto fijo)
                selectedCountry.querySelector('.country-flag').textContent = flag;
                selectedCountry.querySelector('.country-code').textContent = code;
                
                countryDropdown.classList.remove('active');
                syncPhoneValue();
            });
        });
        
        // Cerrar dropdown al hacer click fuera
        document.addEventListener('click', function() {
            countryDropdown.classList.remove('active');
        });
        
        // Prevenir que el click en el dropdown cierre
        countryDropdown.addEventListener('click', function(e) {
            e.stopPropagation();
        });
        
        function syncPhoneValue() {
            var numero = fancy_phone_field.value;
            wtf_phone_field.value = currentCountry + numero;
        }
        
        fancy_phone_field.addEventListener('input', syncPhoneValue);
        fancy_phone_field.addEventListener('blur', syncPhoneValue);
        
        syncPhoneValue();
    });
</script>
{% endblock content %}